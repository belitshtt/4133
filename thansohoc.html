<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máy Tính Chỉ Số Pythagoras</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --primary-color: #3B82F6; /* Màu xanh sáng */
            --primary-hover: #2563EB; /* Màu xanh đậm hơn khi hover */
            --background-color: #F0F9FF; /* Màu nền sáng */
            --card-background: #FFFFFF; /* Màu nền cho card */
            --text-primary: #1F2937; /* Màu chữ chính */
            --text-secondary: #6B7280; /* Màu chữ phụ */
            --border-color: #E5E7EB; /* Màu đường viền */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .card {
            background: var(--card-background);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden; /* Đảm bảo các góc bo tròn được áp dụng đúng */
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            padding: 1.5rem;
            background: #F0F9FF;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .card-title {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-header img {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        .card-body {
            padding: 1.5rem;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        input[type="text"] {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.15s ease-in-out;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn svg {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 0.5rem;
        }

        .name-info {
            background-color: #F0F9FF;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 1rem;
            color: var(--primary-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th {
            background-color: #F9FAFB; /* Một màu xám rất nhạt */
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.15s ease-in-out;
        }

        .result-table tr:hover {
            background-color: #E0F2FE;
        }
        
        /* Canh giữa các cột giá trị trong bảng kết quả */
        .result-table th:not(:first-child),
        .result-table td:not(:first-child) {
            text-align: center;
        }
        
        /* Làm nổi bật các con số kết quả */
        .result-table td:not(:first-child) {
            font-weight: 500;
            color: var(--primary-color);
        }

        .result-section {
            display: flex;
            gap: 2rem;
        }

        /* --- SỬA ĐỔI CHÍNH --- */
        /* Đảm bảo card còn lại chiếm toàn bộ chiều rộng */
        .result-section .card {
            width: 100%; 
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                gap: 1rem;
            }

            .card {
                width: 100%;
            }

            .result-section {
                flex-direction: column;
            }

            .result-section .card {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <img src="https://tshbeli.com.vn/wp-content/uploads/2024/10/anh-logo-Beli.jpg" alt="Logo">
            </div>
            <div class="card-body">
                <div class="input-group">
                    <input type="text" id="inputString" placeholder="Nhập họ tên hoặc chuỗi ký tự (Ví dụ: Nguyễn Văn A)">
                    <button onclick="calculateAll()" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10H9m3-5h3m-6 0h0m0 0h6m-6 0H6"/>
                        </svg>
                        Tính toán
                    </button>
                </div>
                <div id="nameInfo" class="name-info hidden"></div>
            </div>
        </div>

        <div class="result-section">
            <div class="card" hidden>
                <div class="card-header">
                    <h2 class="card-title">Kết quả tính theo tên</h2>
                </div>
                <div class="card-body">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Chỉ số</th>
                                <th>Giá trị</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tương tác</td>
                                <td id="interactionVertical">-</td>
                            </tr>
                            <tr>
                                <td>Phát triển</td>
                                <td id="growthVertical">-</td>
                            </tr>
                            <tr>
                                <td>Nội tâm</td>
                                <td id="innerVertical">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Kết quả tính theo tính cách</h2>
                </div>
                <div class="card-body">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Phân loại</th>
                                <th>Tự đánh giá</th>
                                <th>Giá trị thật</th>
                            </tr>
                        </thead>
                        <tbody id="personalityTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- TOÀN BỘ LOGIC JAVASCRIPT ĐƯỢC GIỮ NGUYÊN ---
        const PYTHAGORAS_MAP = {
            A: 1, J: 1, S: 1,
            B: 2, K: 2, T: 2,
            C: 3, L: 3, U: 3,
            D: 4, M: 4, V: 4,
            E: 5, N: 5, W: 5,
            F: 6, O: 6, X: 6,
            G: 7, P: 7, Y: 7,
            H: 8, Q: 8, Z: 8,
            I: 9, R: 9
        };

        const CATEGORIES = {
            "Physical": { col1: "E", col2: "W", col3: "DM", col4: "" },
            "Mental": { col1: "A", col2: "HJNP", col3: "GL", col4: "" },
            "Emotion": { col1: "IORZ", col2: "BSTX", col3: "CV", col4: "" },
            "Intuitive": { col1: "K", col2: "FQUY", col3: "", col4: "" },
            "Create": { col1: "E", col2: "A", col3: "IORZ", col4: "K" },
            "Dual": { col1: "W", col2: "HJNP", col3: "BSTX", col4: "FQUY" },
            "Grounded": { col1: "DM", col2: "GL", col3: "CV", col4: "" }
        };

        function removeDiacritics(str) {
            const diacriticsMap = {
                'à': 'a', 'á': 'a', 'ả': 'a', 'ã': 'a', 'ạ': 'a',
                'ă': 'a', 'ằ': 'a', 'ắ': 'a', 'ẳ': 'a', 'ẵ': 'a', 'ặ': 'a',
                'â': 'a', 'ầ': 'a', 'ấ': 'a', 'ẩ': 'a', 'ẫ': 'a', 'ậ': 'a',
                'đ': 'd',
                'è': 'e', 'é': 'e', 'ẻ': 'e', 'ẽ': 'e', 'ẹ': 'e',
                'ê': 'e', 'ề': 'e', 'ế': 'e', 'ể': 'e', 'ễ': 'e', 'ệ': 'e',
                'ì': 'i', 'í': 'i', 'ỉ': 'i', 'ĩ': 'i', 'ị': 'i',
                'ò': 'o', 'ó': 'o', 'ỏ': 'o', 'õ': 'o', 'ọ': 'o',
                'ô': 'o', 'ồ': 'o', 'ố': 'o', 'ổ': 'o', 'ỗ': 'o', 'ộ': 'o',
                'ơ': 'o', 'ờ': 'o', 'ớ': 'o', 'ở': 'o', 'ỡ': 'o', 'ợ': 'o',
                'ù': 'u', 'ú': 'u', 'ủ': 'u', 'ũ': 'u', 'ụ': 'u',
                'ư': 'u', 'ừ': 'u', 'ứ': 'u', 'ử': 'u', 'ữ': 'u', 'ự': 'u',
                'ỳ': 'y', 'ý': 'y', 'ỷ': 'y', 'ỹ': 'y', 'ỵ': 'y'
            };
            return str.toLowerCase().replace(/[^\u0000-\u007E]/g, char => diacriticsMap[char] || char);
        }

        function isVowel(letter, index, name) {
            const vowels = ["A", "E", "I", "O", "U"];
            if (letter === "Y") {
                return !(vowels.includes(name[index - 1]) || vowels.includes(name[index + 1]));
            }
            return vowels.includes(letter);
        }

        function sumDigitsDetailed(number) {
            let breakdown = [];
            while (number > 9 && number !== 11 && number !== 22 && number !== 33) {
                breakdown.push(number);
                number = number.toString().split("").reduce((acc, num) => acc + parseInt(num), 0);
            }
            breakdown.push(number);
            return breakdown.length > 1 ? breakdown.join("/") : number;
        }

        function getFilteredName(name) {
            const originalName = name.trim();
            const normalizedName = removeDiacritics(name).toUpperCase();
            let nameParts = normalizedName.replace(/[^A-Z\s]/g, "").trim().split(/\s+/);
            
            const nameInfo = document.getElementById("nameInfo");
            nameInfo.classList.add("hidden");
            
            if (nameParts.length === 1) return nameParts[0];
            return nameParts[0] + " " + nameParts[nameParts.length - 1];
        }

        function calculateName(input) {
            const filteredName = getFilteredName(input);
            if (!filteredName) return;

            let nameParts = filteredName.split(/\s+/);
            let interactionVertical = 0, growthVertical = 0, innerVertical = 0;

            nameParts.forEach(part => {
                let partInteraction = 0, partGrowth = 0, partInner = 0;
                part.split("").forEach((char, index) => {
                    if (PYTHAGORAS_MAP[char]) {
                        if (isVowel(char, index, part)) {
                            partInteraction += PYTHAGORAS_MAP[char];
                        } else {
                            partGrowth += PYTHAGORAS_MAP[char];
                        }
                        partInner += PYTHAGORAS_MAP[char];
                    }
                });
                interactionVertical += partInteraction;
                growthVertical += partGrowth;
                innerVertical += partInner;
            });

            document.getElementById("interactionVertical").textContent = sumDigitsDetailed(interactionVertical);
            document.getElementById("growthVertical").textContent = sumDigitsDetailed(growthVertical);
            document.getElementById("innerVertical").textContent = sumDigitsDetailed(innerVertical);
        }

        function countLetters(input, validLetters) {
            if (!validLetters) return 0;
            return Array.from(input).filter(char => validLetters.includes(char)).length;
        }

        function sumPythagorean(input, validLetters) {
            if (!validLetters) return 0;
            return Array.from(input)
                .filter(char => validLetters.includes(char))
                .reduce((sum, char) => sum + (PYTHAGORAS_MAP[char] || 0), 0);
        }

        function reducePythagorean(number) {
            while (number > 9) {
                number = Array.from(number.toString())
                    .reduce((sum, digit) => sum + parseInt(digit), 0);
            }
            return number;
        }

        function calculatePersonality(input) {
            const normalizedInput = removeDiacritics(input).toUpperCase();
            let tableBody = document.getElementById("personalityTableBody");
            tableBody.innerHTML = "";

            Object.entries(CATEGORIES).forEach(([category, cols]) => {
                let count1 = sumPythagorean(normalizedInput, cols.col1);
                let count2 = sumPythagorean(normalizedInput, cols.col2);
                let count3 = sumPythagorean(normalizedInput, cols.col3);
                let count4 = sumPythagorean(normalizedInput, cols.col4);

                let selfEvaluation = countLetters(normalizedInput, cols.col1) +
                    countLetters(normalizedInput, cols.col2) +
                    countLetters(normalizedInput, cols.col3) +
                    countLetters(normalizedInput, cols.col4);

                let truthValue = reducePythagorean(count1) +
                    reducePythagorean(count2) +
                    reducePythagorean(count3) +
                    reducePythagorean(count4);

                let row = document.createElement("tr");
                row.innerHTML = `
                    <td>${category}</td>
                    <td>${selfEvaluation}</td>
                    <td>${truthValue}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function calculateAll() {
            const input = document.getElementById("inputString").value;
            if (!input.trim()) {
                alert("Vui lòng nhập họ tên hoặc chuỗi ký tự!");
                return;
            }
            calculateName(input);
            calculatePersonality(input);
        }

        document.getElementById("inputString").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault(); // Ngăn form submit (nếu có)
                calculateAll();
            }
        });

        function showLoading() {
            const button = document.querySelector('.btn');
            const originalContent = button.innerHTML;
            button.innerHTML = `
                <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Đang tính toán...
            `;
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 500);
        }

        const originalCalculateAll = calculateAll;
        calculateAll = function() {
            showLoading();
            setTimeout(() => {
                const input = document.getElementById("inputString").value;
                if (!input.trim()) {
                    // Reset alert from original function
                    return;
                }
                originalCalculateAll();
            }, 100);
        };
        
        document.getElementById("inputString").addEventListener("input", function() {
            const inputValue = this.value;
            if (inputValue.trim()) {
                 calculateName(inputValue);
                 calculatePersonality(inputValue);
            } else {
                 // Xóa kết quả nếu ô input trống
                 document.getElementById("personalityTableBody").innerHTML = "";
                 document.getElementById("interactionVertical").textContent = "-";
                 document.getElementById("growthVertical").textContent = "-";
                 document.getElementById("innerVertical").textContent = "-";
            }
        });
    </script>
</body>
</html>